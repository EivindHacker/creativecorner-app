<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="./css/global-style.css" />
		<title>My app</title>
	</head>

	<body>
		<nav>
			<div style="display: flex; align-items: center">
				<span class="logo">Creative Corner</span>
				<div class="corner">&nbsp;</div>
			</div>
			<div style="display: flex; gap: 10px; align-items: center">
				<button class="nav-btn">The Corner</button>
				<button class="nav-btn">Sign Up</button>
				<button class="nav-btn">Sign In</button>
				<button class="nav-btn">User Settings</button>
			</div>
		</nav>

		<script src="./scripts/pageState.mjs"></script>

		<h1 style="text-align: center; margin-top: 50px">The Corner</h1>

		<div class="lg cont">
			<h2>Song Ideas</h2>
			<div class="song-card">
				<h3 id="title">Carrots on Mars</h3>
				<p id="description">
					"Carrots on Mars" is an eccentric and whimsical tune that whimsically explores the idea of growing vegetables on the red planet. Set to a
					catchy melody with a blend of upbeat rhythms and futuristic sounds, the song follows the adventures of a group of intrepid astronauts who
					embark on a mission to cultivate carrots in the barren landscapes of Mars. As they face challenges and unexpected discoveries along the way,
					the song celebrates the spirit of exploration, innovation, and the possibility of finding life, even in the most unlikely of places. With
					its playful lyrics and infectious energy, "Carrots on Mars" is a delightful ode to curiosity and the wonders of the universe.
				</p>
				<h4>Genre Suggestions</h4>
				<div class="genre-wrapper">
					<span class="genre">EDM</span>
					<span class="genre">Electronic</span>
					<span class="genre">Hyper Pop</span>
				</div>
				<h4>Rating</h4>
				<div class="rating-wrapper">
					<span>⭐️</span><span class="rating">5</span>
					<div style="height: 30px; width: 2px; background-color: gray; margin-left: 10px; margin-right: 10px"></div>
					<input style="width: 40px" type="number" min="0" max="5" /> <button>Submit Rating</button>
				</div>
			</div>
		</div>

		<div class="sm cont">
			<h1>Sign up</h1>
			<div><label>Name</label> <input type="text" id="nameInput" /><br /></div>
			<div><label>Email</label> <input type="email" id="emailInput" /><br /></div>
			<div><label>Password</label> <input type="password" id="pswHashInput" /><br /></div>
			<div style="width: 100%">
				<label>User Type</label>
				<div style="display: flex; gap: 10px; margin-top: 5px; margin-bottom: 5px">
					<div><label>Writer</label><input type="radio" id="" name="user-type" checked="true" /></div>
					<div><label>Musician</label><input type="radio" id="user-type" name="user-type" /></div>
				</div>
			</div>
			<button id="createUserButton">Create User</button>
		</div>
		<div class="sm cont">
			<h1>Your Info</h1>
			<div style="display: flex; flex-direction: column; gap: 10px; width: 100%">
				<div><label>Name: </label><span id="nameDisplay"></span></div>
				<div><label>Email: </label><span id="emailDisplay"></span></div>
				<div><label>Account Type: </label><span id="accountTypeDisplay"></span></div>
			</div>
			<button style="margin-top: 20px; color: red; border-color: red">Delete Account</button>
		</div>

		<script>
			const createUserButton = document.getElementById("createUserButton");

			createUserButton.onclick = async function (e) {
				const name = document.getElementById("nameInput").value;
				const email = document.getElementById("emailInput").value;
				const pswHash = document.getElementById("pswHashInput").value;
				const user = {name, email, pswHash};
				const respon = await postTo("/user", user)
					.then((res) => {
						return res.json();
					})
					.then((data) => {
						const userData = JSON.parse(data);
						const authString = btoa(userData.pswHash);
						localStorage.setItem("authString", authString);
						console.log(authString);

						getUser(`/user/authString/${authString}`)
							.then((data) => {
								displayUserData(data);
							})
							.catch((error) => {
								console.error("Error:", error);
								// Handle any errors that occur during the request
							});
					});

				//const userData = await getUser();
			};

			async function postTo(url, data) {
				const header = {
					method: "POST",
					headers: {
						"Content-Type": "application/json",
					},
					body: JSON.stringify(data),
				};

				const respon = await fetch(url, header);
				return respon;
			}

			async function getUser(url) {
				return fetch(url).then((response) => {
					if (!response.ok) {
						throw new Error("Network response was not ok");
					}
					return response.json();
				});
			}

			const nameDisplay = document.getElementById("nameDisplay");
			const emailDisplay = document.getElementById("emailDisplay");
			const accountTypeDisplay = document.getElementById("accountTypeDisplay");

			function displayUserData(data) {
				const userData = JSON.parse(data);
				nameDisplay.innerText = userData[0].name;
				emailDisplay.innerText = userData[0].email;
				accountTypeDisplay.innerText = userData[0].userType;
			}
		</script>
	</body>
</html>
